10 REM ================================
20 REM  BACH - INVENTION No. 8 IN F
30 REM  BWV 779 - SID CHIPTUNE
40 REM  NOVABASIC MML MUSIC ENGINE
50 REM ================================
60 PRINT CHR$(12)
70 MODE 1:COLOR 1,0:GCLS
80 REM -- SID INSTRUMENTS --
90 INSTRUMENT 1,64,0,6,5,4:REM PULSE HARPSICHORD
100 INSTRUMENT 2,64,1,8,6,4:REM PULSE BASS
110 REM -- VOICE 1: RIGHT HAND --
120 MUSIC 1,"T90I1O4L8FAF>C<F>FL16EDCDC<B-AB-AGL8FA>C<A>FCL16A>C<B->C<A>C<B->C<A>C<B->C<FAGAFAGAFAGADFEFDFEFDFEF<L8BG>D<B>FDL16GAGFEFEDCDC<B-L8A>L16DC<B>C<BAGAGFEFEDL8C>L16C<B>L8C<EF>C<E>C<DB>L4CL8CECGC>C<L16BAGAG"
130 MUSIC 1,"O5L16FEFEDC<B->CACA<B->ACA<A>A<L8B-GB-G>D<G>GL16FE-DE-DC<B->C<B-AL8GB->D<B->GDB-D-B-D-B-D-D<A>FDAFL16GFGB-CB-DB-EB-CB-FEFA<B>AD-ADA<B>AEDEG<A>G<B>GD-G<A>GL8FD<B->D<G>FEC<A>C<F>E-L16DFE-FDFE-FDFE-"
140 MUSIC 1,"O5L16F<B->DCD<B->DCD<B->DCD<GB-AB-GB-AB-GB-AB-L8ECGEB-G>L16CDC<B-AB-AGFGFE-L8DL16GFEFEDCDC<B-AB-AGL8F>L16FEL8F<AB->F<A>F<G>EL4F"
150 REM -- VOICE 2: LEFT HAND --
160 MUSIC 2,"T90I2R2.O3L8FAF>C<F>FL16EDCDC<B-AB-AGL8FA>C<A>FCL16A>C<B->C<A>C<B->C<A>C<B->C<FAGAFAGAFAGADFEFDFEFDFEF<L8BG>C<G>ECL16FGFEDEDC<B>C<BAL8G>L16C<BABAGFGFEDEDCGFEFL8G<GR>CECGC>C<L16BAGAGFEFEDL8CEGE>C<G>E-"
170 MUSIC 2,"O3L8<G->E-<G->E-<G-GL16FE-DE-DC<B->C<B-AL8G>GB-G>D<G>GL16FE-DE-DC<B->C<B-AGFG>E<G>E<F>E<G>E<E>E<FEF>D<F>D<E>D<F>D<D>D<L8B-GEGCEAFDF<B>DGED-E<A>D-<L16D>DCD<G>D<A>D<B->D<G>D<C>C<B->C<F>C<G>C<A>C<F"
180 MUSIC 2,"O3L16>C<L8B->DFDB-F>L16DFE-FDFE-FDFE-F<B->DCD<B->DCD<B->DCD<GB-AB-GB-AB-GB-AB-L8ECFCAFL16B->C<B-AGAGFEFEDL8CL16FEDEDC<B->C<B-AGAGF>C<B-AB->L8C<CL4F"
190 VOLUME 15
200 MUSIC PLAY
210 REM -- TITLE --
220 GCOLOR 14:LINE 10,6,309,6:LINE 10,7,309,7
230 COLOR 15,0:PRINT "    BACH - INVENTION No.8 IN F"
240 COLOR 14,0:PRINT "           BWV 779"
250 REM -- KEY LOOKUP TABLES --
260 DIM KT(11),KI(11)
270 REM KT: 0=white 1=black  KI: white key index (or left neighbor for black)
280 FOR I=0 TO 11:READ KT(I),KI(I):NEXT
290 DATA 0,0,1,0,0,1,1,1,0,2,0,3,1,3,0,4,1,4,0,5,1,5,0,6
300 REM -- KEYBOARD CONSTANTS --
310 KW=11:BW=7:KH=44:BH=26
320 KX=6:Y1=50:Y2=130
330 M1=48:M2=36:REM BASE MIDI: V1=C3, V2=C2
340 NK=28:REM 4 OCTAVES = 28 WHITE KEYS
350 REM -- DRAW KEYBOARDS --
360 GCOLOR 1
370 FOR I=0 TO NK-1:X=KX+I*KW:FILL X,Y1,X+KW-2,Y1+KH:FILL X,Y2,X+KW-2,Y2+KH:NEXT I
380 GCOLOR 11
390 FOR I=0 TO NK:X=KX+I*KW-1:LINE X,Y1,X,Y1+KH:LINE X,Y2,X,Y2+KH:NEXT I
400 REM -- BLACK KEYS --
410 DIM BK(4):BK(0)=0:BK(1)=1:BK(2)=3:BK(3)=4:BK(4)=5
420 GCOLOR 0
430 FOR O=0 TO 3:FOR I=0 TO 4
440 X=KX+(O*7+BK(I))*KW+KW-BW/2
450 FILL X,Y1,X+BW-1,Y1+BH:FILL X,Y2,X+BW-1,Y2+BH
460 NEXT I:NEXT O
470 REM -- LABELS --
480 GCOLOR 10:LINE KX-1,Y1+KH+1,KX+NK*KW,Y1+KH+1
490 GCOLOR 12:LINE KX-1,Y2+KH+1,KX+NK*KW,Y2+KH+1
500 COLOR 10,0:LOCATE 1,12:PRINT " V1 Right Hand";
510 COLOR 12,0:LOCATE 1,22:PRINT " V2 Left Hand";
520 REM -- OCTAVE LABELS --
530 COLOR 8,0
540 FOR O=0 TO 3:LOCATE 1+O*10,13:PRINT "C";:PRINT O+3;:NEXT O
550 FOR O=0 TO 3:LOCATE 1+O*10,23:PRINT "C";:PRINT O+2;:NEXT O
560 REM -- MAIN LOOP --
570 P1=0:P2=0
580 VSYNC
590 N1=MNOTE(1):N2=MNOTE(2)
600 REM -- UPDATE VOICE 1 --
610 IF N1=P1 THEN GOTO 670
620 IF P1>0 THEN S=P1-M1:KY=Y1:KC=1:BC=0:GOSUB 780
630 IF N1>0 THEN S=N1-M1:KY=Y1:KC=10:BC=2:GOSUB 780
640 P1=N1
670 REM -- UPDATE VOICE 2 --
680 IF N2=P2 THEN GOTO 740
690 IF P2>0 THEN S=P2-M2:KY=Y2:KC=1:BC=0:GOSUB 780
700 IF N2>0 THEN S=N2-M2:KY=Y2:KC=12:BC=4:GOSUB 780
710 P2=N2
740 IF PLAYING THEN GOTO 580
750 REM -- MUSIC FINISHED --
760 VOLUME 0:COLOR 7,0:LOCATE 1,24:PRINT " Finished.       ";
770 END
780 REM == HIGHLIGHT/CLEAR KEY ==
790 REM IN: S=semitone offset, KY=keyboard Y, KC=white color, BC=black color
800 IF S<0 OR S>47 THEN RETURN
810 OC=INT(S/12):PC=S-OC*12
820 T=KT(PC):W=KI(PC)
830 IF T=1 THEN GOTO 870
840 REM WHITE KEY
850 X=KX+(OC*7+W)*KW:GCOLOR KC:FILL X+1,KY+BH+1,X+KW-3,KY+KH-1
860 RETURN
870 REM BLACK KEY
880 X=KX+(OC*7+W)*KW+KW-BW/2:GCOLOR BC:FILL X+1,KY+1,X+BW-2,KY+BH-1
890 RETURN
