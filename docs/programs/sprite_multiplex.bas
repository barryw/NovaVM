10 REM SPRITE MULTIPLEXING DEMO
20 REM Uses COPPER ADD with sprite register names
30 REM to display 32 sprites using only 8 hardware slots
40 MODE 1 : GCLS : CLS
50 COLOR 1,0 : LOCATE 20,0
60 PRINT "COPPER SPRITE MULTIPLEXING DEMO"
70 LOCATE 16,24 : PRINT "8 SPRITES -> 32 ON SCREEN (PRESS Q)"
80 REM --- DEFINE 4 SHAPE SLOTS ---
90 REM SHAPE 0: SOLID DIAMOND (color 1=white)
100 FOR R=0 TO 15
110   D=7-ABS(R-7) : L=7-D : H=8+D
120   B1=0:B2=0:B3=0:B4=0:B5=0:B6=0:B7=0:B8=0
130   FOR C=0 TO 15
140     P=0 : IF C>=L AND C<=H THEN P=1
150     BY=INT(C/2) : NI=1-(C-BY*2)
160     IF BY=0 THEN B1=B1+P*(16^NI)
170     IF BY=1 THEN B2=B2+P*(16^NI)
180     IF BY=2 THEN B3=B3+P*(16^NI)
190     IF BY=3 THEN B4=B4+P*(16^NI)
200     IF BY=4 THEN B5=B5+P*(16^NI)
210     IF BY=5 THEN B6=B6+P*(16^NI)
220     IF BY=6 THEN B7=B7+P*(16^NI)
230     IF BY=7 THEN B8=B8+P*(16^NI)
240   NEXT C
250   SPRITEDATA 0,R,B1,B2,B3,B4,B5,B6,B7,B8
260 NEXT R
270 REM SHAPE 1: FILLED CIRCLE (color 2=red)
280 FOR R=0 TO 15
290   B1=0:B2=0:B3=0:B4=0:B5=0:B6=0:B7=0:B8=0
300   DY=R-7.5 : RR=7.5
310   DX2=RR*RR-DY*DY
320   IF DX2>=0 THEN DX=SQR(DX2) : XL=INT(7.5-DX+0.5) : XR=INT(7.5+DX+0.5) : GOTO 340
330   GOTO 400
340   IF XL<0 THEN XL=0
350   IF XR>15 THEN XR=15
360   FOR C=XL TO XR
370     BY=INT(C/2):NI=1-(C-BY*2)
380     IF BY=0 THEN B1=B1+2*(16^NI)
381     IF BY=1 THEN B2=B2+2*(16^NI)
382     IF BY=2 THEN B3=B3+2*(16^NI)
383     IF BY=3 THEN B4=B4+2*(16^NI)
384     IF BY=4 THEN B5=B5+2*(16^NI)
385     IF BY=5 THEN B6=B6+2*(16^NI)
386     IF BY=6 THEN B7=B7+2*(16^NI)
387     IF BY=7 THEN B8=B8+2*(16^NI)
390   NEXT C
400   SPRITEDATA 1,R,B1,B2,B3,B4,B5,B6,B7,B8
410 NEXT R
420 REM SHAPE 2: SOLID BLOCK (color 3=cyan)
430 FOR R=0 TO 15
440   SPRITEDATA 2,R,$33,$33,$33,$33,$33,$33,$33,$33
450 NEXT R
460 REM SHAPE 3: X PATTERN (color 3=cyan)
470 FOR R=0 TO 15
480   B1=0:B2=0:B3=0:B4=0:B5=0:B6=0:B7=0:B8=0
490   C1=R : C2=15-R
500   BY=INT(C1/2):NI=1-(C1-BY*2)
510   IF BY=0 THEN B1=B1+3*(16^NI)
520   IF BY=1 THEN B2=B2+3*(16^NI)
530   IF BY=2 THEN B3=B3+3*(16^NI)
540   IF BY=3 THEN B4=B4+3*(16^NI)
550   IF BY=4 THEN B5=B5+3*(16^NI)
560   IF BY=5 THEN B6=B6+3*(16^NI)
570   IF BY=6 THEN B7=B7+3*(16^NI)
580   IF BY=7 THEN B8=B8+3*(16^NI)
590   IF C2<>C1 THEN BY=INT(C2/2):NI=1-(C2-BY*2)
600   IF C2<>C1 AND BY=0 THEN B1=B1+3*(16^NI)
610   IF C2<>C1 AND BY=1 THEN B2=B2+3*(16^NI)
620   IF C2<>C1 AND BY=2 THEN B3=B3+3*(16^NI)
630   IF C2<>C1 AND BY=3 THEN B4=B4+3*(16^NI)
640   IF C2<>C1 AND BY=4 THEN B5=B5+3*(16^NI)
650   IF C2<>C1 AND BY=5 THEN B6=B6+3*(16^NI)
660   IF C2<>C1 AND BY=6 THEN B7=B7+3*(16^NI)
670   IF C2<>C1 AND BY=7 THEN B8=B8+3*(16^NI)
680   SPRITEDATA 3,R,B1,B2,B3,B4,B5,B6,B7,B8
690 NEXT R
700 REM --- ASSIGN SHAPES TO SPRITES 0-7 ---
710 FOR I=0 TO 7
720   SPRITESHAPE I, I AND 3
730 NEXT I
740 REM --- POSITION + ENABLE SPRITES ---
750 FOR I=0 TO 7
760   SPRITE I, 20+I*38, 10
770   SPRITE I, ON
780 NEXT I
790 REM --- INIT BOUNCE STATE ---
800 DIM XV(7), XD(7)
810 FOR I=0 TO 7
820   XV(I)=20+I*38 : XD(I)=I+1
830 NEXT I
840 REM --- BUILD COPPER LIST ---
850 COPPER CLEAR
860 REM ROW 1 at Y=60
870 FOR I=0 TO 7
880   S=(I+1) AND 3
890   COPPER ADD 0, 55, SPRSHAPE(I), S
900   COPPER ADD 0, 56, SPRY(I), 60
910 NEXT I
920 REM ROW 2 at Y=110
930 FOR I=0 TO 7
940   S=(I+2) AND 3
950   COPPER ADD 0, 105, SPRSHAPE(I), S
960   COPPER ADD 0, 106, SPRY(I), 110
970 NEXT I
980 REM ROW 3 at Y=160
990 FOR I=0 TO 7
1000   S=(I+3) AND 3
1010   COPPER ADD 0, 155, SPRSHAPE(I), S
1020   COPPER ADD 0, 156, SPRY(I), 160
1030 NEXT I
1040 REM RESTORE ROW 0 before next frame
1050 FOR I=0 TO 7
1060   S=I AND 3
1070   COPPER ADD 0, 0, SPRSHAPE(I), S
1080   COPPER ADD 0, 1, SPRY(I), 10
1090 NEXT I
1100 COPPER ON
1110 REM --- ANIMATION LOOP ---
1120 VSYNC
1130 GET K : IF K=81 OR K=113 THEN 1200
1140 REM BOUNCE EACH SPRITE HORIZONTALLY
1150 FOR I=0 TO 7
1160   XV(I)=XV(I)+XD(I)
1170   IF XV(I)>290 THEN XD(I)=-XD(I) : XV(I)=290
1180   IF XV(I)<10 THEN XD(I)=-XD(I) : XV(I)=10
1190   SPRITE I, XV(I), 10
1195 NEXT I
1196 GOTO 1120
1200 REM --- CLEANUP ---
1210 COPPER OFF : COPPER CLEAR
1220 FOR I=0 TO 7 : SPRITE I, OFF : NEXT I
1230 MODE 0 : CLS
1240 PRINT "DONE!"
1250 END
