10 REM ======================================================
20 REM NOVA WARP SHOWCASE - DMA + BLITTER
30 REM SPACES: 0=CPU 1=CHAR 2=COLOR 3=GFX 4=SPRITE 5=XRAM
40 REM ======================================================
50 MODE 1:COLOR 1,0:GCLS:CLS
60 RAM=0:SCR=1:COL=2:SW=80
70 MSG=24576:TILE=24832:TITLE=25088
80 ROW=22
90 REM -- FAST CLEAR USING DMA --
100 DMAFILL SCR,0,2000,32
110 DMAFILL COL,0,2000,0
120 REM -- TITLE UPLOAD VIA DMACOPY --
130 T$="NOVA WARP  -  DMA + BLITTER SHOWCASE"
140 TL=LEN(T$)
150 FOR I=1 TO TL:POKE TITLE+I-1,ASC(MID$(T$,I,1)):NEXT I
160 DMACOPY RAM,TITLE,SCR,1*SW+20,TL
170 DMAFILL COL,1*SW+20,TL,15
180 U$="FLOWING BANDS + SCROLL TEXT + MOVING HIGHLIGHTS"
190 UL=LEN(U$)
200 FOR I=1 TO UL:POKE TITLE+64+I-1,ASC(MID$(U$,I,1)):NEXT I
210 DMACOPY RAM,TITLE+64,SCR,3*SW+14,UL
220 DMAFILL COL,3*SW+14,UL,11
230 REM -- MESSAGE BUFFER IN CPU RAM (DMA FEEDS RIGHT EDGE) --
240 A$="   NOVA VM DMA ENGINE   +   BLITTER ENGINE   =   FAST MOTION   "
250 ML=LEN(A$)
260 FOR I=1 TO ML:POKE MSG+I-1,ASC(MID$(A$,I,1)):NEXT I
270 REM -- BASE COLORS FOR BAND AREA --
280 FOR Y=6 TO 19
285 DMAFILL SCR,Y*SW,SW,35
290 C=(Y*2) AND 15
300 BLITFILL COL,Y*SW,SW,SW,1,C
310 NEXT Y
320 REM -- SMALL 8X4 HIGHLIGHT TILE IN CPU RAM --
330 W=8:H=4
340 FOR Y=0 TO H-1
350 FOR X=0 TO W-1
360 C=14
365 IF X=0 THEN C=15
366 IF X=W-1 THEN C=15
367 IF Y=0 THEN C=15
368 IF Y=H-1 THEN C=15
370 POKE TILE+Y*W+X,C
380 NEXT X
390 NEXT Y
400 REM -- MAIN SHOW LOOP --
410 M=0:PX=0:PY=8:DX=3:DY=1
420 FOR T=0 TO 1600
430 REM BLITTER: IN-PLACE HORIZONTAL SCROLL OF COLOR BANDS
440 FOR Y=6 TO 19
450 A=Y*SW
460 BLITCOPY COL,A+1,SW,COL,A,SW,79,1
470 C=(T+Y*3) AND 15
480 BLITFILL COL,A+79,SW,1,1,C
490 NEXT Y
500 REM BLITTER: SCROLL TEXT ROW LEFT
510 A=ROW*SW
520 BLITCOPY SCR,A+1,SW,SCR,A,SW,79,1
530 BLITCOPY COL,A+1,SW,COL,A,SW,79,1
540 REM DMA: INJECT NEXT MESSAGE BYTE AT RIGHT EDGE
550 DMACOPY RAM,MSG+M,SCR,A+79,1
560 DMAFILL COL,A+79,1,15
570 M=M+1:IF M>=ML THEN M=0
580 REM BLITTER: MOVE HIGHLIGHT TILE ACROSS BANDS
590 BLITCOPY RAM,TILE,W,COL,PY*SW+PX,SW,W,H
595 PX=PX+DX:IF PX<=0 THEN DX=3
596 IF PX>=SW-W THEN DX=-3
598 PY=PY+DY:IF PY<=8 THEN DY=1
599 IF PY>=15 THEN DY=-1
620 VSYNC
630 NEXT T
640 COLOR 15,0:LOCATE 1,24:PRINT "DONE. RUN AGAIN.";
650 END
