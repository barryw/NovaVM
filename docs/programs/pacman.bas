10 REM PAC-MAN MAZE DATA AND DRAWING
20 REM TASK 1: MAZE LAYOUT, PELLETS, SCORE HEADER
30 DIM M(19,11)
40 REM SET DISPLAY MODE
50 MODE 2:GCLS
60 POKE 40961,0:POKE 40973,0
70 COLOR 1,0:CLS
80 REM READ MAZE DATA INTO ARRAY
90 PC=0
100 FOR TY=0 TO 11
110 READ A$
120 FOR TX=0 TO 19
130 C$=MID$(A$,TX+1,1)
140 IF C$="W" THEN M(TX,TY)=1
150 IF C$="." THEN M(TX,TY)=2:PC=PC+1
160 IF C$="O" THEN M(TX,TY)=3:PC=PC+1
170 IF C$="_" THEN M(TX,TY)=4
180 IF C$="D" THEN M(TX,TY)=5
190 IF C$="X" THEN M(TX,TY)=6
200 NEXT TX
210 NEXT TY
220 REM DRAW MAZE TILES
230 FOR TY=0 TO 11
240 FOR TX=0 TO 19
250 V=M(TX,TY)
260 X0=TX*16:Y0=TY*16+8
270 IF V=1 THEN GOSUB 500
280 IF V=2 THEN GOSUB 600
290 IF V=3 THEN GOSUB 700
300 IF V=5 THEN GOSUB 800
310 NEXT TX
320 NEXT TY
330 REM PRINT SCORE HEADER
340 COLOR 1,0
350 LOCATE 0,0:PRINT "SCORE:000000";
360 LOCATE 28,0:PRINT "HI:000000";
370 LOCATE 53,0:PRINT "LIVES:3";
380 LOCATE 68,0:PRINT "LEVEL:1";
390 REM DONE - PC HOLDS TOTAL PELLET COUNT
395 REM --- TASK 2: PAC-MAN SPRITE AND MOVEMENT ---
400 PT=10:PU=10:PX=160:PY=168
410 PD=2:BD=2:SP=0:MV=0:FC=0:SC=0:HI=0:WK=0
420 REM LOAD PAC-MAN SPRITE SHAPES FROM DATA
430 FOR SI=0 TO 1
440 FOR SR=0 TO 15
450 READ D1,D2,D3,D4,D5,D6,D7,D8
460 SPRITEDATA SI,SR,D1,D2,D3,D4,D5,D6,D7,D8
470 NEXT SR
480 NEXT SI
485 SPRITESHAPE 0,0
486 SPRITE 0,ON
487 SPRITE 0,PX,PY
488 SPRITE 0,PRIORITY,2
489 SPRITE 0,FLIPX,ON
490 GOTO 1100
500 REM DRAW WALL - BLUE FILLED RECT
510 GCOLOR 6
520 FILL X0,Y0,X0+15,Y0+15
530 RETURN
600 REM DRAW PELLET - SMALL WHITE DOT (4X4)
610 GCOLOR 1
620 FILL X0+6,Y0+6,X0+9,Y0+9
630 RETURN
700 REM DRAW POWER PELLET - LARGE WHITE DOT (8X8)
710 GCOLOR 1
720 FILL X0+4,Y0+4,X0+11,Y0+11
730 RETURN
800 REM DRAW GHOST HOUSE DOOR - PINK LINE
810 GCOLOR 10
820 FILL X0,Y0+6,X0+15,Y0+8
830 RETURN
900 REM MAZE DATA - 20 CHARS PER ROW, 12 ROWS
910 DATA "WWWWWWWWWWWWWWWWWWWW"
920 DATA "W........WW........W"
930 DATA "W.WW.WWW.WW.WWW.WW.W"
940 DATA "WOWW.WWW.WW.WWW.WWOW"
950 DATA "W..................W"
960 DATA "X.WW.WW.WWWW.WW.WW.X"
970 DATA "W....WW..DD..WW....W"
980 DATA "W.WW.WWWW__WWWW.WW.W"
990 DATA "W.WW....W__W....WW.W"
1000 DATA "W....WWW.WW.WWW....W"
1010 DATA "WOWW............WWOW"
1020 DATA "WWWWWWWWWWWWWWWWWWWW"
1100 REM === GAME LOOP ===
1110 VSYNC
1120 GET K
1130 IF K=119 OR K=87 THEN BD=0
1140 IF K=115 OR K=83 THEN BD=1
1150 IF K=97 OR K=65 THEN BD=2
1160 IF K=100 OR K=68 THEN BD=3
1170 GOSUB 1200
1171 IF M(PT,PU)<2 OR M(PT,PU)>3 THEN GOTO 1180
1172 X0=PT*16:Y0=PU*16+8:GCOLOR 0
1173 IF M(PT,PU)=3 THEN SC=SC+50:FILL X0+4,Y0+4,X0+11,Y0+11:GOTO 1175
1174 SC=SC+10:FILL X0+6,Y0+6,X0+9,Y0+9
1175 M(PT,PU)=0:PC=PC-1:WK=1-WK:SOUND 60+WK*4,3
1176 GOSUB 1500
1180 SPRITE 0,PX,PY
1190 REM ANIMATION
1191 FC=FC+1
1192 IF MV=0 THEN SPRITESHAPE 0,1:GOTO 1198
1193 IF (FC AND 3)<>0 THEN GOTO 1198
1194 SA=1-SA:SPRITESHAPE 0,SA
1198 IF PD=2 THEN SPRITE 0,FLIPX,ON:GOTO 1110
1199 SPRITE 0,FLIPX,OFF:GOTO 1110
1200 REM === MOVE PAC-MAN SUBROUTINE ===
1210 IF MV=1 THEN GOTO 1300
1220 REM STOPPED - TRY BUFFERED DIRECTION
1230 GOSUB 1400:REM SET NX,NY FROM BD
1240 IF WP=1 THEN PD=BD:MV=1:SP=0:RETURN
1250 REM TRY CURRENT DIRECTION
1260 GOSUB 1450:REM SET NX,NY FROM PD
1270 IF WP=1 THEN MV=1:SP=0
1280 RETURN
1300 REM MOVING - ADVANCE PIXELS
1310 SP=SP+4
1320 IF PD=0 THEN PY=PY-4
1330 IF PD=1 THEN PY=PY+4
1340 IF PD=2 THEN PX=PX-4
1350 IF PD=3 THEN PX=PX+4
1360 IF SP<16 THEN RETURN
1370 REM ARRIVED AT NEXT TILE
1380 SP=0
1381 IF PD=0 THEN PU=PU-1
1382 IF PD=1 THEN PU=PU+1
1383 IF PD=2 THEN PT=PT-1
1384 IF PD=3 THEN PT=PT+1
1385 REM TUNNEL WRAP
1386 IF PT<0 THEN PT=19:PX=PT*16
1387 IF PT>19 THEN PT=0:PX=PT*16
1390 REM TRY BUFFERED DIRECTION AT NEW TILE
1391 IF BD=PD THEN GOTO 1395
1392 GOSUB 1400:REM CHECK BD
1393 IF WP=1 THEN PD=BD:RETURN
1395 REM TRY CURRENT DIRECTION
1396 GOSUB 1450:REM CHECK PD
1397 IF WP=1 THEN RETURN
1398 MV=0:RETURN
1400 REM === WALL CHECK FOR BD DIRECTION ===
1410 NX=PT:NY=PU
1411 IF BD=0 THEN NY=PU-1
1412 IF BD=1 THEN NY=PU+1
1413 IF BD=2 THEN NX=PT-1
1414 IF BD=3 THEN NX=PT+1
1415 REM TUNNEL WRAP CHECK
1416 IF NX<0 THEN NX=19
1417 IF NX>19 THEN NX=0
1420 IF NY<0 OR NY>11 THEN WP=1:RETURN
1425 TV=M(NX,NY)
1430 WP=1:IF TV=1 OR TV=5 THEN WP=0
1435 RETURN
1450 REM === WALL CHECK FOR PD DIRECTION ===
1460 NX=PT:NY=PU
1461 IF PD=0 THEN NY=PU-1
1462 IF PD=1 THEN NY=PU+1
1463 IF PD=2 THEN NX=PT-1
1464 IF PD=3 THEN NX=PT+1
1465 REM TUNNEL WRAP CHECK
1466 IF NX<0 THEN NX=19
1467 IF NX>19 THEN NX=0
1470 IF NY<0 OR NY>11 THEN WP=1:RETURN
1475 TV=M(NX,NY)
1480 WP=1:IF TV=1 OR TV=5 THEN WP=0
1485 RETURN
1500 REM === UPDATE SCORE DISPLAY ===
1510 S$=MID$(STR$(SC),2)
1520 S$=MID$("000000",1,6-LEN(S$))+S$
1530 LOCATE 6,0:PRINT S$;
1540 IF SC<=HI THEN RETURN
1550 HI=SC:S$=MID$(STR$(HI),2)
1560 S$=MID$("000000",1,6-LEN(S$))+S$
1570 LOCATE 31,0:PRINT S$;:RETURN
2000 REM === PAC-MAN SHAPE DATA ===
2001 REM SHAPE 0: MOUTH OPEN (FACING RIGHT)
2002 REM 16 ROWS, 8 BYTES/ROW, COLOR 7=YELLOW
2010 DATA 0,0,7,119,119,112,0,0
2011 DATA 0,7,119,119,119,119,112,0
2012 DATA 0,119,119,119,119,119,119,0
2013 DATA 7,119,119,119,119,0,119,112
2014 DATA 7,119,119,119,119,119,119,112
2015 DATA 119,119,119,119,119,119,112,0
2016 DATA 119,119,119,119,119,112,0,0
2017 DATA 119,119,119,119,112,0,0,0
2018 DATA 119,119,119,119,112,0,0,0
2019 DATA 119,119,119,119,119,112,0,0
2020 DATA 119,119,119,119,119,119,112,0
2021 DATA 7,119,119,119,119,119,119,112
2022 DATA 7,119,119,119,119,119,119,112
2023 DATA 0,119,119,119,119,119,119,0
2024 DATA 0,7,119,119,119,119,112,0
2025 DATA 0,0,7,119,119,112,0,0
2030 REM SHAPE 1: MOUTH CLOSED (FULL CIRCLE)
2040 DATA 0,0,7,119,119,112,0,0
2041 DATA 0,7,119,119,119,119,112,0
2042 DATA 0,119,119,119,119,119,119,0
2043 DATA 7,119,119,119,119,0,119,112
2044 DATA 7,119,119,119,119,119,119,112
2045 DATA 119,119,119,119,119,119,119,119
2046 DATA 119,119,119,119,119,119,119,119
2047 DATA 119,119,119,119,119,119,119,119
2048 DATA 119,119,119,119,119,119,119,119
2049 DATA 119,119,119,119,119,119,119,119
2050 DATA 119,119,119,119,119,119,119,119
2051 DATA 7,119,119,119,119,119,119,112
2052 DATA 7,119,119,119,119,119,119,112
2053 DATA 0,119,119,119,119,119,119,0
2054 DATA 0,7,119,119,119,119,112,0
2055 DATA 0,0,7,119,119,112,0,0
