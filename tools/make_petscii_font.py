#!/usr/bin/env python3
"""Generate PETSCII font binaries for the e6502 emulator.

Produces two 2048-byte font files (256 chars x 8 bytes, 8x8 pixel glyphs)
indexed by ASCII-compatible byte positions:

  petscii_upper.bin  -- C64 character set 1: uppercase + graphics
  petscii_lower.bin  -- C64 character set 2: lowercase + uppercase

The glyph data is the authentic Commodore 64 character ROM (first 2048 bytes
for upper/graphics, second 2048 bytes for lower/upper).  The ROM is in
"screen code" order; this script remaps it to ASCII-compatible positions so
that character RAM bytes map directly to the correct glyph.

Screen-code order (each half of ROM):
  0-31   : @, A-Z, [, pound, ], up-arrow, left-arrow
  32-63  : space, !, ", #, $, %, &, ', (, ), *, +, ,, -, ., /, 0-9, :, ;, <, =, >, ?
  64-95  : horizontal bar, shifted graphic characters (Shift+A..Z, etc.)
  96-127 : Commodore-key graphic characters

Remapping (uppercase set as example):
  Screen code  0 (@)       -> ASCII 0x40
  Screen codes 1-26 (A-Z)  -> ASCII 0x41-0x5A
  Screen code 27 ([)       -> ASCII 0x5B
  Screen code 28 (pound)   -> ASCII 0x5C
  Screen code 29 (])       -> ASCII 0x5D
  Screen code 30 (up-arrow)-> ASCII 0x5E
  Screen code 31 (left-arrow)->ASCII 0x5F  (underscore position)
  Screen codes 32-63       -> ASCII 0x20-0x3F (space..?)
  Screen codes 64-89       -> 0x80-0x99 (shifted graphics)
  Screen codes 90-95       -> 0x9A-0x9F (remaining shifted graphics)
  Screen codes 96-121      -> 0xA0-0xB9 (C= key graphics)
  Screen codes 122-127     -> 0xBA-0xBF (remaining C= key graphics)

Usage:
  python3 make_petscii_font.py [output_dir]

Default output_dir is ../e6502.Avalonia/Resources (relative to this script).
"""

import os
import sys

# ---------------------------------------------------------------------------
# Authentic C64 character ROM data -- 4096 bytes total.
# First 2048 bytes: upper/graphics (character set 1).
# Second 2048 bytes: lower/upper (character set 2).
#
# Each group of 8 bytes defines one 8x8 glyph in screen-code order
# (characters 0-127).  Bit 7 = leftmost pixel.
# ---------------------------------------------------------------------------

C64_CHARROM = bytes([
    # === Character Set 1: Upper/Graphics (screen codes 0-127) ===
    # SC  0: @
    0x3C, 0x66, 0x6E, 0x6E, 0x60, 0x62, 0x3C, 0x00,
    # SC  1: A
    0x18, 0x3C, 0x66, 0x7E, 0x66, 0x66, 0x66, 0x00,
    # SC  2: B
    0x7C, 0x66, 0x66, 0x7C, 0x66, 0x66, 0x7C, 0x00,
    # SC  3: C
    0x3C, 0x66, 0x60, 0x60, 0x60, 0x66, 0x3C, 0x00,
    # SC  4: D
    0x78, 0x6C, 0x66, 0x66, 0x66, 0x6C, 0x78, 0x00,
    # SC  5: E
    0x7E, 0x60, 0x60, 0x78, 0x60, 0x60, 0x7E, 0x00,
    # SC  6: F
    0x7E, 0x60, 0x60, 0x78, 0x60, 0x60, 0x60, 0x00,
    # SC  7: G
    0x3C, 0x66, 0x60, 0x6E, 0x66, 0x66, 0x3C, 0x00,
    # SC  8: H
    0x66, 0x66, 0x66, 0x7E, 0x66, 0x66, 0x66, 0x00,
    # SC  9: I
    0x3C, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3C, 0x00,
    # SC 10: J
    0x1E, 0x0C, 0x0C, 0x0C, 0x0C, 0x6C, 0x38, 0x00,
    # SC 11: K
    0x66, 0x6C, 0x78, 0x70, 0x78, 0x6C, 0x66, 0x00,
    # SC 12: L
    0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x7E, 0x00,
    # SC 13: M
    0x63, 0x77, 0x7F, 0x6B, 0x63, 0x63, 0x63, 0x00,
    # SC 14: N
    0x66, 0x76, 0x7E, 0x7E, 0x6E, 0x66, 0x66, 0x00,
    # SC 15: O
    0x3C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00,
    # SC 16: P
    0x7C, 0x66, 0x66, 0x7C, 0x60, 0x60, 0x60, 0x00,
    # SC 17: Q
    0x3C, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x0E, 0x00,
    # SC 18: R
    0x7C, 0x66, 0x66, 0x7C, 0x78, 0x6C, 0x66, 0x00,
    # SC 19: S
    0x3C, 0x66, 0x60, 0x3C, 0x06, 0x66, 0x3C, 0x00,
    # SC 20: T
    0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00,
    # SC 21: U
    0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00,
    # SC 22: V
    0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x18, 0x00,
    # SC 23: W
    0x63, 0x63, 0x63, 0x6B, 0x7F, 0x77, 0x63, 0x00,
    # SC 24: X
    0x66, 0x66, 0x3C, 0x18, 0x3C, 0x66, 0x66, 0x00,
    # SC 25: Y
    0x66, 0x66, 0x66, 0x3C, 0x18, 0x18, 0x18, 0x00,
    # SC 26: Z
    0x7E, 0x06, 0x0C, 0x18, 0x30, 0x60, 0x7E, 0x00,
    # SC 27: [
    0x3C, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3C, 0x00,
    # SC 28: pound sign
    0x0C, 0x12, 0x30, 0x7C, 0x30, 0x62, 0xFC, 0x00,
    # SC 29: ]
    0x3C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x3C, 0x00,
    # SC 30: up arrow
    0x00, 0x18, 0x3C, 0x7E, 0x18, 0x18, 0x18, 0x18,
    # SC 31: left arrow
    0x00, 0x10, 0x30, 0x7F, 0x7F, 0x30, 0x10, 0x00,
    # SC 32: space
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    # SC 33: !
    0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x18, 0x00,
    # SC 34: "
    0x66, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00,
    # SC 35: #
    0x66, 0x66, 0xFF, 0x66, 0xFF, 0x66, 0x66, 0x00,
    # SC 36: $
    0x18, 0x3E, 0x60, 0x3C, 0x06, 0x7C, 0x18, 0x00,
    # SC 37: %
    0x62, 0x66, 0x0C, 0x18, 0x30, 0x66, 0x46, 0x00,
    # SC 38: &
    0x3C, 0x66, 0x3C, 0x38, 0x67, 0x66, 0x3F, 0x00,
    # SC 39: '
    0x06, 0x0C, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00,
    # SC 40: (
    0x0C, 0x18, 0x30, 0x30, 0x30, 0x18, 0x0C, 0x00,
    # SC 41: )
    0x30, 0x18, 0x0C, 0x0C, 0x0C, 0x18, 0x30, 0x00,
    # SC 42: *
    0x00, 0x66, 0x3C, 0xFF, 0x3C, 0x66, 0x00, 0x00,
    # SC 43: +
    0x00, 0x18, 0x18, 0x7E, 0x18, 0x18, 0x00, 0x00,
    # SC 44: ,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x30,
    # SC 45: -
    0x00, 0x00, 0x00, 0x7E, 0x00, 0x00, 0x00, 0x00,
    # SC 46: .
    0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00,
    # SC 47: /
    0x00, 0x03, 0x06, 0x0C, 0x18, 0x30, 0x60, 0x00,
    # SC 48: 0
    0x3C, 0x66, 0x6E, 0x76, 0x66, 0x66, 0x3C, 0x00,
    # SC 49: 1
    0x18, 0x18, 0x38, 0x18, 0x18, 0x18, 0x7E, 0x00,
    # SC 50: 2
    0x3C, 0x66, 0x06, 0x0C, 0x30, 0x60, 0x7E, 0x00,
    # SC 51: 3
    0x3C, 0x66, 0x06, 0x1C, 0x06, 0x66, 0x3C, 0x00,
    # SC 52: 4
    0x06, 0x0E, 0x1E, 0x66, 0x7F, 0x06, 0x06, 0x00,
    # SC 53: 5
    0x7E, 0x60, 0x7C, 0x06, 0x06, 0x66, 0x3C, 0x00,
    # SC 54: 6
    0x3C, 0x66, 0x60, 0x7C, 0x66, 0x66, 0x3C, 0x00,
    # SC 55: 7
    0x7E, 0x66, 0x0C, 0x18, 0x18, 0x18, 0x18, 0x00,
    # SC 56: 8
    0x3C, 0x66, 0x66, 0x3C, 0x66, 0x66, 0x3C, 0x00,
    # SC 57: 9
    0x3C, 0x66, 0x66, 0x3E, 0x06, 0x66, 0x3C, 0x00,
    # SC 58: :
    0x00, 0x00, 0x18, 0x00, 0x00, 0x18, 0x00, 0x00,
    # SC 59: ;
    0x00, 0x00, 0x18, 0x00, 0x00, 0x18, 0x18, 0x30,
    # SC 60: <
    0x0E, 0x18, 0x30, 0x60, 0x30, 0x18, 0x0E, 0x00,
    # SC 61: =
    0x00, 0x00, 0x7E, 0x00, 0x7E, 0x00, 0x00, 0x00,
    # SC 62: >
    0x70, 0x18, 0x0C, 0x06, 0x0C, 0x18, 0x70, 0x00,
    # SC 63: ?
    0x3C, 0x66, 0x06, 0x0C, 0x18, 0x00, 0x18, 0x00,
    # SC 64: horizontal bar (top of graphics area)
    0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00,
    # SC 65: Shift+A graphic
    0x08, 0x1C, 0x3E, 0x7F, 0x7F, 0x1C, 0x3E, 0x00,
    # SC 66: Shift+B graphic
    0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18,
    # SC 67: Shift+C graphic
    0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00,
    # SC 68: Shift+D graphic
    0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00,
    # SC 69: Shift+E graphic
    0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
    # SC 70: Shift+F graphic
    0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00,
    # SC 71: Shift+G graphic
    0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00,
    # SC 72: Shift+H graphic
    0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
    # SC 73: Shift+I graphic
    0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0,
    # SC 74: Shift+J graphic
    0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0,
    # SC 75: Shift+K graphic (but really this is the "cross" graphic)
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    # SC 76: Shift+L graphic
    0x00, 0x00, 0x00, 0x00, 0x0F, 0x0F, 0x0F, 0x0F,
    # SC 77: Shift+M graphic
    0xF0, 0xF0, 0xF0, 0xF0, 0x00, 0x00, 0x00, 0x00,
    # SC 78: Shift+N graphic
    0x0F, 0x0F, 0x0F, 0x0F, 0x00, 0x00, 0x00, 0x00,
    # SC 79: Shift+O graphic (checker bottom-right quarter)
    0x00, 0x00, 0x00, 0x00, 0xF0, 0xF0, 0xF0, 0xF0,
    # SC 80: Shift+P graphic
    0x0F, 0x0F, 0x0F, 0x0F, 0xF0, 0xF0, 0xF0, 0xF0,
    # SC 81: Shift+Q graphic (round top-left)
    0x03, 0x07, 0x0F, 0x1F, 0x3F, 0x7F, 0xFF, 0xFF,
    # SC 82: Shift+R graphic
    0xC0, 0xE0, 0xF0, 0xF8, 0xFC, 0xFE, 0xFF, 0xFF,
    # SC 83: Shift+S graphic (round bottom-right)
    0xFF, 0xFE, 0xFC, 0xF8, 0xF0, 0xE0, 0xC0, 0x80,
    # SC 84: Shift+T graphic (round bottom-left)
    0xFF, 0x7F, 0x3F, 0x1F, 0x0F, 0x07, 0x03, 0x01,
    # SC 85: Shift+U graphic (half circle right)
    0x01, 0x03, 0x07, 0x0F, 0x0F, 0x07, 0x03, 0x01,
    # SC 86: Shift+V graphic
    0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0,
    # SC 87: Shift+W graphic
    0x18, 0x18, 0x18, 0xFF, 0xFF, 0x18, 0x18, 0x18,
    # SC 88: Shift+X graphic (checkerboard)
    0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0xAA,
    # SC 89: Shift+Y graphic
    0x18, 0x18, 0x18, 0x18, 0xFF, 0xFF, 0xFF, 0xFF,
    # SC 90: Shift+Z graphic
    0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF,
    # SC 91
    0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xFF,
    # SC 92
    0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03,
    # SC 93
    0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xFF, 0xFF,
    # SC 94
    0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03,
    # SC 95
    0x00, 0x00, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0,
    # SC 96: C= key + A graphic
    0xCC, 0x33, 0xCC, 0x33, 0xCC, 0x33, 0xCC, 0x33,
    # SC 97: C= key + B graphic
    0x00, 0x00, 0x00, 0x00, 0xCC, 0xCC, 0x33, 0x33,
    # SC 98: C= key + C graphic
    0xFF, 0xFF, 0xFF, 0xFF, 0x33, 0x33, 0xCC, 0xCC,
    # SC 99: C= key + D graphic
    0x00, 0x00, 0x00, 0x00, 0x33, 0x33, 0xCC, 0xCC,
    # SC100: C= key + E graphic
    0x33, 0x33, 0xCC, 0xCC, 0x33, 0x33, 0xCC, 0xCC,
    # SC101: C= key + F graphic
    0x00, 0xFC, 0xFC, 0xFC, 0xFC, 0xFC, 0x00, 0x00,
    # SC102: C= key + G graphic
    0x00, 0x00, 0x00, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F,
    # SC103: C= key + H graphic
    0x00, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03,
    # SC104: C= key + I graphic
    0x18, 0x18, 0x18, 0x1F, 0x1F, 0x18, 0x18, 0x18,
    # SC105: C= key + J graphic
    0x00, 0x00, 0x00, 0x00, 0xF8, 0xF8, 0x18, 0x18,
    # SC106: C= key + K graphic
    0x18, 0x18, 0x18, 0x1F, 0x1F, 0x00, 0x00, 0x00,
    # SC107: C= key + L graphic
    0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    # SC108: C= key + M graphic
    0x18, 0x18, 0x18, 0xF8, 0xF8, 0x18, 0x18, 0x18,
    # SC109: C= key + N graphic
    0x18, 0x18, 0x18, 0xFF, 0xFF, 0x00, 0x00, 0x00,
    # SC110: C= key + O graphic
    0x00, 0x00, 0x00, 0xFF, 0xFF, 0x18, 0x18, 0x18,
    # SC111: C= key + P graphic
    0x18, 0x18, 0x18, 0xF8, 0xF8, 0x00, 0x00, 0x00,
    # SC112: C= key + Q graphic
    0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0,
    # SC113: C= key + R graphic
    0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0,
    # SC114: C= key + S graphic
    0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
    # SC115: C= key + T graphic
    0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF,
    # SC116: C= key + U graphic
    0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
    # SC117: C= key + V graphic (left T junction)
    0x00, 0x00, 0x00, 0xF8, 0xF8, 0x18, 0x18, 0x18,
    # SC118: C= key + W graphic
    0x18, 0x18, 0x18, 0x1F, 0x1F, 0x18, 0x18, 0x18,
    # SC119: C= key + X graphic
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00,
    # SC120: C= key + Y graphic (bottom of T)
    0x18, 0x18, 0x18, 0xFF, 0xFF, 0x18, 0x18, 0x18,
    # SC121: C= key + Z graphic
    0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF,
    # SC122
    0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00,
    # SC123
    0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0x00,
    # SC124
    0xFF, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18,
    # SC125
    0xE0, 0xE0, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00,
    # SC126
    0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00,
    # SC127
    0x18, 0x18, 0x18, 0xFF, 0xFF, 0x18, 0x18, 0x18,

    # === Character Set 2: Lower/Upper (screen codes 0-127) ===
    # SC  0: @
    0x3C, 0x66, 0x6E, 0x6E, 0x60, 0x62, 0x3C, 0x00,
    # SC  1: a (lowercase)
    0x00, 0x00, 0x3C, 0x06, 0x3E, 0x66, 0x3E, 0x00,
    # SC  2: b (lowercase)
    0x60, 0x60, 0x7C, 0x66, 0x66, 0x66, 0x7C, 0x00,
    # SC  3: c (lowercase)
    0x00, 0x00, 0x3C, 0x60, 0x60, 0x60, 0x3C, 0x00,
    # SC  4: d (lowercase)
    0x06, 0x06, 0x3E, 0x66, 0x66, 0x66, 0x3E, 0x00,
    # SC  5: e (lowercase)
    0x00, 0x00, 0x3C, 0x66, 0x7E, 0x60, 0x3C, 0x00,
    # SC  6: f (lowercase)
    0x0E, 0x18, 0x3E, 0x18, 0x18, 0x18, 0x18, 0x00,
    # SC  7: g (lowercase)
    0x00, 0x00, 0x3E, 0x66, 0x66, 0x3E, 0x06, 0x7C,
    # SC  8: h (lowercase)
    0x60, 0x60, 0x7C, 0x66, 0x66, 0x66, 0x66, 0x00,
    # SC  9: i (lowercase)
    0x18, 0x00, 0x38, 0x18, 0x18, 0x18, 0x3C, 0x00,
    # SC 10: j (lowercase)
    0x06, 0x00, 0x06, 0x06, 0x06, 0x06, 0x66, 0x3C,
    # SC 11: k (lowercase)
    0x60, 0x60, 0x66, 0x6C, 0x78, 0x6C, 0x66, 0x00,
    # SC 12: l (lowercase)
    0x38, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3C, 0x00,
    # SC 13: m (lowercase)
    0x00, 0x00, 0x66, 0x7F, 0x7F, 0x6B, 0x63, 0x00,
    # SC 14: n (lowercase)
    0x00, 0x00, 0x7C, 0x66, 0x66, 0x66, 0x66, 0x00,
    # SC 15: o (lowercase)
    0x00, 0x00, 0x3C, 0x66, 0x66, 0x66, 0x3C, 0x00,
    # SC 16: p (lowercase)
    0x00, 0x00, 0x7C, 0x66, 0x66, 0x7C, 0x60, 0x60,
    # SC 17: q (lowercase)
    0x00, 0x00, 0x3E, 0x66, 0x66, 0x3E, 0x06, 0x06,
    # SC 18: r (lowercase)
    0x00, 0x00, 0x7C, 0x66, 0x60, 0x60, 0x60, 0x00,
    # SC 19: s (lowercase)
    0x00, 0x00, 0x3E, 0x60, 0x3C, 0x06, 0x7C, 0x00,
    # SC 20: t (lowercase)
    0x18, 0x18, 0x7E, 0x18, 0x18, 0x18, 0x0E, 0x00,
    # SC 21: u (lowercase)
    0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x3E, 0x00,
    # SC 22: v (lowercase)
    0x00, 0x00, 0x66, 0x66, 0x66, 0x3C, 0x18, 0x00,
    # SC 23: w (lowercase)
    0x00, 0x00, 0x63, 0x6B, 0x7F, 0x3E, 0x36, 0x00,
    # SC 24: x (lowercase)
    0x00, 0x00, 0x66, 0x3C, 0x18, 0x3C, 0x66, 0x00,
    # SC 25: y (lowercase)
    0x00, 0x00, 0x66, 0x66, 0x66, 0x3E, 0x0C, 0x78,
    # SC 26: z (lowercase)
    0x00, 0x00, 0x7E, 0x0C, 0x18, 0x30, 0x7E, 0x00,
    # SC 27: [
    0x3C, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3C, 0x00,
    # SC 28: pound sign
    0x0C, 0x12, 0x30, 0x7C, 0x30, 0x62, 0xFC, 0x00,
    # SC 29: ]
    0x3C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x3C, 0x00,
    # SC 30: up arrow
    0x00, 0x18, 0x3C, 0x7E, 0x18, 0x18, 0x18, 0x18,
    # SC 31: left arrow
    0x00, 0x10, 0x30, 0x7F, 0x7F, 0x30, 0x10, 0x00,
    # SC 32: space
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    # SC 33: !
    0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x18, 0x00,
    # SC 34: "
    0x66, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00,
    # SC 35: #
    0x66, 0x66, 0xFF, 0x66, 0xFF, 0x66, 0x66, 0x00,
    # SC 36: $
    0x18, 0x3E, 0x60, 0x3C, 0x06, 0x7C, 0x18, 0x00,
    # SC 37: %
    0x62, 0x66, 0x0C, 0x18, 0x30, 0x66, 0x46, 0x00,
    # SC 38: &
    0x3C, 0x66, 0x3C, 0x38, 0x67, 0x66, 0x3F, 0x00,
    # SC 39: '
    0x06, 0x0C, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00,
    # SC 40: (
    0x0C, 0x18, 0x30, 0x30, 0x30, 0x18, 0x0C, 0x00,
    # SC 41: )
    0x30, 0x18, 0x0C, 0x0C, 0x0C, 0x18, 0x30, 0x00,
    # SC 42: *
    0x00, 0x66, 0x3C, 0xFF, 0x3C, 0x66, 0x00, 0x00,
    # SC 43: +
    0x00, 0x18, 0x18, 0x7E, 0x18, 0x18, 0x00, 0x00,
    # SC 44: ,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x30,
    # SC 45: -
    0x00, 0x00, 0x00, 0x7E, 0x00, 0x00, 0x00, 0x00,
    # SC 46: .
    0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00,
    # SC 47: /
    0x00, 0x03, 0x06, 0x0C, 0x18, 0x30, 0x60, 0x00,
    # SC 48: 0
    0x3C, 0x66, 0x6E, 0x76, 0x66, 0x66, 0x3C, 0x00,
    # SC 49: 1
    0x18, 0x18, 0x38, 0x18, 0x18, 0x18, 0x7E, 0x00,
    # SC 50: 2
    0x3C, 0x66, 0x06, 0x0C, 0x30, 0x60, 0x7E, 0x00,
    # SC 51: 3
    0x3C, 0x66, 0x06, 0x1C, 0x06, 0x66, 0x3C, 0x00,
    # SC 52: 4
    0x06, 0x0E, 0x1E, 0x66, 0x7F, 0x06, 0x06, 0x00,
    # SC 53: 5
    0x7E, 0x60, 0x7C, 0x06, 0x06, 0x66, 0x3C, 0x00,
    # SC 54: 6
    0x3C, 0x66, 0x60, 0x7C, 0x66, 0x66, 0x3C, 0x00,
    # SC 55: 7
    0x7E, 0x66, 0x0C, 0x18, 0x18, 0x18, 0x18, 0x00,
    # SC 56: 8
    0x3C, 0x66, 0x66, 0x3C, 0x66, 0x66, 0x3C, 0x00,
    # SC 57: 9
    0x3C, 0x66, 0x66, 0x3E, 0x06, 0x66, 0x3C, 0x00,
    # SC 58: :
    0x00, 0x00, 0x18, 0x00, 0x00, 0x18, 0x00, 0x00,
    # SC 59: ;
    0x00, 0x00, 0x18, 0x00, 0x00, 0x18, 0x18, 0x30,
    # SC 60: <
    0x0E, 0x18, 0x30, 0x60, 0x30, 0x18, 0x0E, 0x00,
    # SC 61: =
    0x00, 0x00, 0x7E, 0x00, 0x7E, 0x00, 0x00, 0x00,
    # SC 62: >
    0x70, 0x18, 0x0C, 0x06, 0x0C, 0x18, 0x70, 0x00,
    # SC 63: ?
    0x3C, 0x66, 0x06, 0x0C, 0x18, 0x00, 0x18, 0x00,
    # SC 64: horizontal bar
    0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00,
    # SC 65: A (uppercase in set 2)
    0x18, 0x3C, 0x66, 0x7E, 0x66, 0x66, 0x66, 0x00,
    # SC 66: B
    0x7C, 0x66, 0x66, 0x7C, 0x66, 0x66, 0x7C, 0x00,
    # SC 67: C
    0x3C, 0x66, 0x60, 0x60, 0x60, 0x66, 0x3C, 0x00,
    # SC 68: D
    0x78, 0x6C, 0x66, 0x66, 0x66, 0x6C, 0x78, 0x00,
    # SC 69: E
    0x7E, 0x60, 0x60, 0x78, 0x60, 0x60, 0x7E, 0x00,
    # SC 70: F
    0x7E, 0x60, 0x60, 0x78, 0x60, 0x60, 0x60, 0x00,
    # SC 71: G
    0x3C, 0x66, 0x60, 0x6E, 0x66, 0x66, 0x3C, 0x00,
    # SC 72: H
    0x66, 0x66, 0x66, 0x7E, 0x66, 0x66, 0x66, 0x00,
    # SC 73: I
    0x3C, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3C, 0x00,
    # SC 74: J
    0x1E, 0x0C, 0x0C, 0x0C, 0x0C, 0x6C, 0x38, 0x00,
    # SC 75: K
    0x66, 0x6C, 0x78, 0x70, 0x78, 0x6C, 0x66, 0x00,
    # SC 76: L
    0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x7E, 0x00,
    # SC 77: M
    0x63, 0x77, 0x7F, 0x6B, 0x63, 0x63, 0x63, 0x00,
    # SC 78: N
    0x66, 0x76, 0x7E, 0x7E, 0x6E, 0x66, 0x66, 0x00,
    # SC 79: O
    0x3C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00,
    # SC 80: P
    0x7C, 0x66, 0x66, 0x7C, 0x60, 0x60, 0x60, 0x00,
    # SC 81: Q
    0x3C, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x0E, 0x00,
    # SC 82: R
    0x7C, 0x66, 0x66, 0x7C, 0x78, 0x6C, 0x66, 0x00,
    # SC 83: S
    0x3C, 0x66, 0x60, 0x3C, 0x06, 0x66, 0x3C, 0x00,
    # SC 84: T
    0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00,
    # SC 85: U
    0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00,
    # SC 86: V
    0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x18, 0x00,
    # SC 87: W
    0x63, 0x63, 0x63, 0x6B, 0x7F, 0x77, 0x63, 0x00,
    # SC 88: X
    0x66, 0x66, 0x3C, 0x18, 0x3C, 0x66, 0x66, 0x00,
    # SC 89: Y
    0x66, 0x66, 0x66, 0x3C, 0x18, 0x18, 0x18, 0x00,
    # SC 90: Z
    0x7E, 0x06, 0x0C, 0x18, 0x30, 0x60, 0x7E, 0x00,
    # SC 91
    0x3C, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3C, 0x00,
    # SC 92
    0x0C, 0x12, 0x30, 0x7C, 0x30, 0x62, 0xFC, 0x00,
    # SC 93
    0x3C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x3C, 0x00,
    # SC 94
    0x00, 0x18, 0x3C, 0x7E, 0x18, 0x18, 0x18, 0x18,
    # SC 95
    0x00, 0x10, 0x30, 0x7F, 0x7F, 0x30, 0x10, 0x00,
    # SC 96: C= key + A graphic (same graphics in both sets)
    0xCC, 0x33, 0xCC, 0x33, 0xCC, 0x33, 0xCC, 0x33,
    # SC 97: C= key + B graphic
    0x00, 0x00, 0x00, 0x00, 0xCC, 0xCC, 0x33, 0x33,
    # SC 98: C= key + C graphic
    0xFF, 0xFF, 0xFF, 0xFF, 0x33, 0x33, 0xCC, 0xCC,
    # SC 99: C= key + D graphic
    0x00, 0x00, 0x00, 0x00, 0x33, 0x33, 0xCC, 0xCC,
    # SC100: C= key + E graphic
    0x33, 0x33, 0xCC, 0xCC, 0x33, 0x33, 0xCC, 0xCC,
    # SC101: C= key + F graphic
    0x00, 0xFC, 0xFC, 0xFC, 0xFC, 0xFC, 0x00, 0x00,
    # SC102: C= key + G graphic
    0x00, 0x00, 0x00, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F,
    # SC103: C= key + H graphic
    0x00, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03,
    # SC104: C= key + I graphic
    0x18, 0x18, 0x18, 0x1F, 0x1F, 0x18, 0x18, 0x18,
    # SC105: C= key + J graphic
    0x00, 0x00, 0x00, 0x00, 0xF8, 0xF8, 0x18, 0x18,
    # SC106: C= key + K graphic
    0x18, 0x18, 0x18, 0x1F, 0x1F, 0x00, 0x00, 0x00,
    # SC107: C= key + L graphic
    0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    # SC108: C= key + M graphic
    0x18, 0x18, 0x18, 0xF8, 0xF8, 0x18, 0x18, 0x18,
    # SC109: C= key + N graphic
    0x18, 0x18, 0x18, 0xFF, 0xFF, 0x00, 0x00, 0x00,
    # SC110: C= key + O graphic
    0x00, 0x00, 0x00, 0xFF, 0xFF, 0x18, 0x18, 0x18,
    # SC111: C= key + P graphic
    0x18, 0x18, 0x18, 0xF8, 0xF8, 0x00, 0x00, 0x00,
    # SC112: C= key + Q graphic
    0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0,
    # SC113: C= key + R graphic
    0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0,
    # SC114: C= key + S graphic
    0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
    # SC115: C= key + T graphic
    0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF,
    # SC116: C= key + U graphic
    0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
    # SC117: C= key + V graphic
    0x00, 0x00, 0x00, 0xF8, 0xF8, 0x18, 0x18, 0x18,
    # SC118: C= key + W graphic
    0x18, 0x18, 0x18, 0x1F, 0x1F, 0x18, 0x18, 0x18,
    # SC119: C= key + X graphic
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00,
    # SC120: C= key + Y graphic
    0x18, 0x18, 0x18, 0xFF, 0xFF, 0x18, 0x18, 0x18,
    # SC121: C= key + Z graphic
    0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF,
    # SC122
    0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00,
    # SC123
    0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0x00,
    # SC124
    0xFF, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18,
    # SC125
    0xE0, 0xE0, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00,
    # SC126
    0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00,
    # SC127
    0x18, 0x18, 0x18, 0xFF, 0xFF, 0x18, 0x18, 0x18,
])

assert len(C64_CHARROM) == 2048, f"ROM data should be 2048 bytes, got {len(C64_CHARROM)}"


def get_glyph(rom_half: bytes, screen_code: int) -> bytes:
    """Extract an 8-byte glyph from a 1024-byte ROM half by screen code."""
    offset = screen_code * 8
    return rom_half[offset:offset + 8]


def remap_charset(rom_half: bytes) -> bytearray:
    """Remap a 1024-byte ROM half from screen-code order to ASCII order.

    Returns a 2048-byte font where each glyph is at its ASCII position.
    """
    out = bytearray(2048)  # 256 chars * 8 bytes

    def put(ascii_pos: int, sc: int):
        glyph = get_glyph(rom_half, sc)
        out[ascii_pos * 8 : ascii_pos * 8 + 8] = glyph

    # Screen codes 0-31 -> various ASCII positions
    # SC 0 = @ -> ASCII 0x40
    put(0x40, 0)
    # SC 1-26 = A-Z -> ASCII 0x41-0x5A
    for i in range(1, 27):
        put(0x40 + i, i)
    # SC 27 = [ -> ASCII 0x5B
    put(0x5B, 27)
    # SC 28 = pound -> ASCII 0x5C (backslash position)
    put(0x5C, 28)
    # SC 29 = ] -> ASCII 0x5D
    put(0x5D, 29)
    # SC 30 = up arrow -> ASCII 0x5E (caret position)
    put(0x5E, 30)
    # SC 31 = left arrow -> ASCII 0x5F (underscore position)
    put(0x5F, 31)

    # Screen codes 32-63 -> ASCII 0x20-0x3F (space through ?)
    for i in range(32):
        put(0x20 + i, 32 + i)

    # Screen codes 64-95 -> shifted graphics at 0x80-0x9F
    for i in range(32):
        put(0x80 + i, 64 + i)

    # Screen codes 96-127 -> C= key graphics at 0xA0-0xBF
    for i in range(32):
        put(0xA0 + i, 96 + i)

    # Lowercase ASCII positions (0x61-0x7A) -> show uppercase A-Z
    # The C64 uppercase set has no lowercase; lowercase input rendered as uppercase.
    # We duplicate the uppercase glyphs so mixed-case output (like "Ready") is visible.
    for i in range(1, 27):
        put(0x60 + i, i)  # same glyphs as SC 1-26 (A-Z)

    # 0x60 (backtick) -> horizontal bar graphic (SC 64)
    put(0x60, 64)
    # 0x7B-0x7F -> fill with remaining shifted graphics (SC 91-95)
    for i in range(5):
        put(0x7B + i, 91 + i)

    return out


def remap_lower_charset(rom_half: bytes) -> bytearray:
    """Remap the lowercase/uppercase ROM half to ASCII order.

    In charset 2, screen codes 1-26 are lowercase a-z, and
    screen codes 65-90 are uppercase A-Z.  We place:
      - lowercase a-z at ASCII 0x61-0x7A
      - uppercase A-Z at ASCII 0x41-0x5A
    """
    out = bytearray(2048)

    def put(ascii_pos: int, sc: int):
        glyph = get_glyph(rom_half, sc)
        out[ascii_pos * 8 : ascii_pos * 8 + 8] = glyph

    # SC 0 = @ -> ASCII 0x40
    put(0x40, 0)

    # SC 1-26 = lowercase a-z -> ASCII 0x61-0x7A
    for i in range(1, 27):
        put(0x60 + i, i)

    # SC 27 = [ -> ASCII 0x5B
    put(0x5B, 27)
    # SC 28 = pound -> ASCII 0x5C
    put(0x5C, 28)
    # SC 29 = ] -> ASCII 0x5D
    put(0x5D, 29)
    # SC 30 = up arrow -> ASCII 0x5E
    put(0x5E, 30)
    # SC 31 = left arrow -> ASCII 0x5F
    put(0x5F, 31)

    # Screen codes 32-63 -> ASCII 0x20-0x3F (space through ?)
    for i in range(32):
        put(0x20 + i, 32 + i)

    # Screen codes 64 = horizontal bar -> 0x60 (backtick position)
    put(0x60, 64)

    # SC 65-90 = uppercase A-Z -> ASCII 0x41-0x5A
    for i in range(26):
        put(0x41 + i, 65 + i)

    # SC 91-95 -> shifted graphic extras at 0x7B-0x7F ({|}~DEL positions)
    for i in range(5):
        put(0x7B + i, 91 + i)

    # Screen codes 96-127 -> C= key graphics at 0xA0-0xBF
    for i in range(32):
        put(0xA0 + i, 96 + i)

    # Also copy shifted graphics (SC 64-89) to 0x80-0x99
    # (same graphic chars available in both sets)
    for i in range(26):
        put(0x80 + i, 64 + i)
    # SC 90-95 -> 0x9A-0x9F
    for i in range(6):
        put(0x9A + i, 90 + i)

    return out


def main():
    script_dir = os.path.dirname(os.path.abspath(__file__))
    if len(sys.argv) > 1:
        output_dir = sys.argv[1]
    else:
        output_dir = os.path.join(script_dir, "..", "e6502.Avalonia", "Resources")

    os.makedirs(output_dir, exist_ok=True)

    # Split ROM into two 1024-byte halves (128 screen codes * 8 bytes each)
    upper_rom = C64_CHARROM[:1024]
    lower_rom = C64_CHARROM[1024:2048]

    # Remap upper/graphics set
    upper_font = remap_charset(upper_rom)
    assert len(upper_font) == 2048

    # Remap lower/upper set
    lower_font = remap_lower_charset(lower_rom)
    assert len(lower_font) == 2048

    upper_path = os.path.join(output_dir, "petscii_upper.bin")
    lower_path = os.path.join(output_dir, "petscii_lower.bin")

    with open(upper_path, "wb") as f:
        f.write(upper_font)
    print(f"Wrote {upper_path} ({len(upper_font)} bytes)")

    with open(lower_path, "wb") as f:
        f.write(lower_font)
    print(f"Wrote {lower_path} ({len(lower_font)} bytes)")

    # Sanity checks
    # Space (ASCII 0x20) should be all zeros
    space_offset = 0x20 * 8
    for y in range(8):
        assert upper_font[space_offset + y] == 0, f"Upper space row {y} not blank"
        assert lower_font[space_offset + y] == 0, f"Lower space row {y} not blank"

    # 'A' in upper set (ASCII 0x41) should be non-zero
    a_offset = 0x41 * 8
    assert any(upper_font[a_offset + y] != 0 for y in range(8)), "Upper 'A' is blank"
    assert any(lower_font[a_offset + y] != 0 for y in range(8)), "Lower 'A' is blank"

    print("Sanity checks passed.")


if __name__ == "__main__":
    main()
